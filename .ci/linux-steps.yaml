steps:
# Checkout repository
- checkout: self
  clean: true
  fetchDepth: 1

- bash: echo "##vso[task.prependpath]$CONDA/bin"
  displayName: Add conda to PATH

- bash: >
    conda install --yes --quiet
    conda-build
  displayName: Install conda-build
- script: |
    wget https://github.com/root-project/cling/archive/master.tar.gz
    git clone --depth=1 https://github.com/root-project/cling.git
    python .ci/hash.py
    rm master.tar.gz
    rm -rf cling
  displayName: Patch meta

- bash: >
    conda build . --no-anaconda-upload -c conda-forge
  displayName: Conda build

- task: PublishBuildArtifacts@1
  inputs:
    pathtoPublish: /usr/share/miniconda/conda-bld/linux-64/ 
    artifactName: 'cling'
  displayName: 'Publish artifacts'
